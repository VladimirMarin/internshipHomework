<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>MyChatIO</title>
		<link rel="stylesheet" type="text/css" href="./style1.css">
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
		
	</head>
	<body>





		<div id = "container">



			<div id = "loginContainer">
				<h2>My Chat App</h2>
				<p>Create Username:</p>
				<form id = "UsernameForm">
					<input size = "35" id = "username" placeholder="Enter you username" class="form-control">
					<input class="btn btn-sm btn-primary btn-block" type="submit" value="submit">
				</form>
			</div>
			


			<div id = "mainChatWrapper">



				<div id='chatWrapper' >


					
					<div id = "chatWindow" class="col-md-4">

						<h2  >ChatIO</h2>
						<form id="messageForm"  >
							<textarea size="50" id = "message" placeholder="Type something...">
							</textarea>
							<input type="submit" value="Send" style="margin-top: 3px; margin-bottom: 3px;">
						</form>

					</div>

				</div>

				




				<div id="userWrapper" style="opacity: 0.8;">
					<label>Online users:</label>
					<ul id="userList"></ul>
				</div>
		</div>

			
	</div>



		<script type="text/javascript">
			$(function(){
				var socket = io.connect();
				var $messageForm = $('#messageForm');
				var $message = $('#message');
				var $chat = $('#chatWindow');
				var $UsernameForm = $('#UsernameForm');
				var $username = $('#username');


				//it sends data from textarea 
				$messageForm.submit(function(e){
					e.preventDefault();
					//console.log($message.val());
					socket.emit('send message', $message.val());
					$message.val("");
				});

				//it adds message
				socket.on('new message', function(data){
					$chat.append('<div class="well"><strong>'+data.user+'</strong>:<br/>'+data.msg+'</div>');
				});

				$UsernameForm.submit(function(e){
					e.preventDefault();
					//console.log($username.val());
					socket.emit('new username', $username.val(), function(data){
						if(data){
							$('#loginContainer').hide();
							$('#mainChatWrapper').show();
							$('#mainChatWrapper').css("display" , "inline")

						}
					});
					$username.val("");
				});

				socket.on('update users', function(data){
					var userList = '';
					for( i = 0 ; i < data.length; i++){
						userList += '<li>'+data[i]+'</li>';
						console.log(data[i]);
					} 
					$('#userList').html(userList);
				});


				//$(".well").css('margin-top', '5px');
				
				$('#loginContainer' ).hover(function(){
    				
    				$(this).css('opacity','0.9');
    			},function(){
        			
        			$(this).css('opacity', '0.6');
    			});
			});

		</script>
	</body>
</html>