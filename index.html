<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>MyChatIO</title>
		<link rel="stylesheet" type="text/css" href="./style1.css">
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
		
	</head>
	<body>





		<div id = "container">



			<div id = "loginContainer">
				<h2>My Chat App</h2>
				<p>Create Username:</p>
				<form id = "UsernameForm">
					<input size = "35" id = "username" placeholder="Enter you username">
					<input type="submit" value="submit">
				</form>
			</div>
			


			<div id = "mainChatWrapper">



				<div id='chatWrapper'>


					
					<div id = "chatWindow">

						<h2>ChatIO</h2>
						<form id="messageForm">
							<textarea id = "message" placeholder="Type something...">
							</textarea>
							<br/>
							<input type="submit" value="Send">
						</form>

					</div>

				</div>

				




				<div id="userWrapper">
					<label>Online users:</label>
					<ul id="userList"></ul>
				</div>
			</div>

			
	</div>



		<script type="text/javascript">
			$(function(){
				var socket = io.connect();
				var $messageForm = $('#messageForm');
				var $message = $('#message');
				var $chat = $('#chatWindow');
				var $UsernameForm = $('#UsernameForm');
				var $username = $('#username');


				//it sends data from textarea 
				$messageForm.submit(function(e){
					e.preventDefault();
					//console.log($message.val());
					socket.emit('send message', $message.val());
					$message.val("");
				});

				//it adds message
				socket.on('new message', function(data){
					$chat.append('<div>'+data.msg+'</div>');
				});

				$UsernameForm.submit(function(e){
					e.preventDefault();
					//console.log($username.val());
					socket.emit('new username', $username.val(), function(data){
						if(data){
							$('#loginContainer').hide();
							$('#mainChatWrapper').show();
							$('#mainChatWrapper').css("display" , "inline")

						}
					});
					$username.val("");
				});

				socket.on('update users', function(data){
					var userList = '';
					for( i = 0 ; i < data.length; i++){
						userList += '<li>'+data[i]+'</li>';
						console.log(data[i]);
					} 
					$('#userList').html(userList);
				});

			});

		</script>
	</body>
</html>